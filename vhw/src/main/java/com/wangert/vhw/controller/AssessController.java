package com.wangert.vhw.controller;

import com.wangert.vhw.service.PatchService;
import com.wangert.vhw.service.VulnerabilityService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.*;

import javax.servlet.http.HttpSession;

/**
 *
 * 漏洞评价控制层
 * @Author：Wangert
 *
 */

@Controller
public class AssessController {

    @Autowired
    VulnerabilityService vulnerabilityService;
    @Autowired
    PatchService patchService;

    @PostMapping("/submitVulnerabilityScore")
    public String submitVulnerabilityScore(HttpSession httpSession, String vulnerabilityIpfsHash, String score_1, String score_2, String score_3, String score_4, String score_5) {


        String assessor = httpSession.getAttribute("loginUsername").toString();

        int totalScore = Integer.valueOf(score_1).intValue() + Integer.valueOf(score_2).intValue() + Integer.valueOf(score_3).intValue() + Integer.valueOf(score_4).intValue() + Integer.valueOf(score_5).intValue();
        System.out.println(assessor + " totalScore:" + totalScore);

        vulnerabilityService.assessVulnerabilityByIpfsHash(assessor, vulnerabilityIpfsHash, totalScore);

        /*
        System.out.println(vulnerabilityIpfsHash);
        System.out.println(score_1);
        System.out.println(score_2);
        System.out.println(score_3);
        System.out.println(score_4);
        System.out.println(score_5);
*/
        return "assessVulnerability";

    }


    @PostMapping("/submitPatchScore")
    public String submitPatchScore(HttpSession httpSession, String patchIpfsHash, String score_1, String score_2, String score_3, String score_4, String score_5) {

        String assessor = httpSession.getAttribute("loginUsername").toString();

        int totalScore = Integer.parseInt(score_1) + Integer.parseInt(score_2) + Integer.parseInt(score_3) + Integer.valueOf(score_4).intValue() + Integer.valueOf(score_5).intValue();
        System.out.println(assessor + " totalScore:" + totalScore);

        patchService.assessPatchByIpfsHash(assessor, patchIpfsHash, totalScore);

        /*
        System.out.println(patchIpfsHash);
        System.out.println(score_1);
        System.out.println(score_2);
        System.out.println(score_3);
        System.out.println(score_4);
        System.out.println(score_5);

*/
        return "assessPatch";

    }

}
