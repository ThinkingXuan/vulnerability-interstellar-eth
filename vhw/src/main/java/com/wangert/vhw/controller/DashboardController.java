package com.wangert.vhw.controller;

import com.wangert.vhw.service.HomeDataAcquireService;
import com.wangert.vhw.utils.FileUtil;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;

import java.util.*;

/**
 *
 * 平台监控界面控制层
 * @Author：Wangert
 *
 */

@Controller
public class DashboardController {
    @Autowired
    HomeDataAcquireService homeDataAcquireService ;

    @RequestMapping("/dashboard")
    public String dashboard(Model model) {

        //漏洞数据
        List<Map<String, Object>> vulnerabilityDataList = homeDataAcquireService.acquireVulnerabilityList();
        Collections.reverse(vulnerabilityDataList);

        //补丁数据
        List<Map<String, Object>> patchDataList = homeDataAcquireService.acquirePatchList();
        Collections.reverse(patchDataList);

        //漏洞评估数据
        List<Map<String, Object>> vulnerabilityAssessmentRecords = homeDataAcquireService.acquireVulnerabilityAssessmentRecords();
        Collections.reverse(vulnerabilityAssessmentRecords);

        //补丁评估数据
        List<Map<String, Object>> patchAssessmentRecords = homeDataAcquireService.acquirePatchAssessmentRecords();
        Collections.reverse(patchAssessmentRecords);

        /*
        List<Map<String, Object>> patchList = new ArrayList<>();

        Map<String, Object> map1 = new HashMap<>();
        map1.put("ipfsHash", "QmY4QYLFo1ZkobL63d5aYb7dLURjmpjcBwAL9raxkqYYE8");
        map1.put("vulnerabilityHash", "QmTuSjAM7wdpAmWDrTABWgguwUfCXPfmYnRLvDiTCBj5w9");
        map1.put("patchName", "patchOfVulnerabilityGGG");
        map1.put("username", "wangjitao");
        map1.put("releaseDate", "2019/10/03 13:23:11");
        map1.put("description", "1.test/n2.testtest");
        map1.put("star", 23);
        map1.put("score", 0);

        patchList.add(map1);
        //System.out.println(vulnerabilityList.get(0).get("ipfsHash"));

        Map<String, Object> map2 = new HashMap<>();
        map2.put("ipfsHash", "QmSsw6EcnwEiTT9c4rnAGeSENvsJMepNHmbrgi2S9bXNJr");
        map2.put("vulnerabilityHash", "QmbFMke1KXqnYyBBWxB74N4c5SBnJMVAiMNRcGu6x1AwQH");
        map2.put("patchName", "patchOfVhw_001");
        map2.put("username", "guyu");
        map2.put("releaseDate", "2019/09/29 23:23:11");
        map2.put("description", "1.test/n2.testtest");
        map2.put("star", 234);
        map2.put("score", 12);

        patchList.add(map2);
        //System.out.println(vulnerabilityList.get(1).get("ipfsHash"));

        Map<String, Object> map3 = new HashMap<>();
        map3.put("ipfsHash", "QmUgAgTVxq7UeY3Tbumz72fBsSvkUnveEgEkWvVquEvJVV");
        map3.put("vulnerabilityHash", "QmbFMke1KXqnYyBBWxB74N4c5SBnJMVAiMNRcGu6x1AwQH");
        map3.put("patchName", "patchOfVhw_002");
        map3.put("username", "wangjitao");
        map3.put("releaseDate", "2019/09/28 23:44:11");
        map3.put("description", "1.test/n2.testtest");
        map3.put("star", 2034);
        map3.put("score", 234);

        patchList.add(map3);

        */

        int numberOfUser = homeDataAcquireService.getNumberOfUser();


        model.addAttribute("vulnerabilityDataList", vulnerabilityDataList);
        model.addAttribute("patchDataList", patchDataList);
        model.addAttribute("numberOfUser", numberOfUser);
        model.addAttribute("vulnerabilityAssessmentRecords", vulnerabilityAssessmentRecords);
        model.addAttribute("patchAssessmentRecords", patchAssessmentRecords);

        return "dashboard";
    }


}
